<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../import-commons/import-commons.html">
<link rel="import" href="../import-observe/import-observe.html">

<script>
  Polymer({
    is: "observe-path",
    properties: {
      object: {
        type: Object,
        notify: true,
        observer: "_onObjectChanged"
      },
      path: String,
      value: {
        type: Object,
        notify: true
      }
    },
    ready: function() {
      this._onObjectChanged(this.object, undefined);
    },
    _fire: function(newValue, oldValue) {
      this.notifyPath("value", newValue);
    },
    _onObjectChanged: function(newValue, oldValue) {
      if (this._observer) this._observer.close();
      if (!newValue) return;
      if (!this.path) return;

      var observable = newValue;
      if (andiwand.isString(newValue)) {
        observable = andiwand.byPath(window, newValue);
        if (!observable) return;
      }

      this._observer = new PathObserver(observable, this.path);
      this._observer.open($.proxy(function(newValue, oldValue) {
        this._fire(newValue, oldValue);
      }), this);

      this._fire(andiwand.byPath(observable, this.path), undefined);
    }
  });
</script>
