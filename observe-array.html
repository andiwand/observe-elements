<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="import-observe.html">

<script>
  Polymer({
    is: "observe-array",
    properties: {
      array: {
        type: Array,
        notify: true,
        observer: "_onArrayChanged"
      }
    },
    _fire: function(isNew, array, splices) {
      this.fire("changed", {
        isNew: isNew,
        array: array,
        splices: splices
      });
    },
    _onArrayChanged: function(array) {
      if (!array) return;
      if (this._observer) this._observer.close();
      this._observer = new ArrayObserver(array);
      this._observer.open($.proxy(function(splices) {
        this._fire(false, this.array, splices);
      }), this);

      this._fire(true, this.array);
    }
  });
</script>
